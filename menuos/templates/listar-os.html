{% extends "base.html" %}
{% block body %}

<!-- Filtros -->
<form method="GET" class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-6 text-sm text-white">
  <div>
    <label for="campo" class="block mb-1 font-semibold">Filtrar por campo</label>
    <select name="campo" id="campo"
            class="w-full bg-slate-700 px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">
      <option value="numero_os" {% if campo_selecionado == 'numero_os' %}selected{% endif %}>Nº OS</option>
      <option value="cc" {% if campo_selecionado == 'cc' %}selected{% endif %}>Centro de Custo</option>
      <option value="cod_cliente__nome_cliente" {% if campo_selecionado == 'cod_cliente__nome_cliente' %}selected{% endif %}>Cliente</option>
    </select>
  </div>

  <div>
    <label for="busca" class="block mb-1 font-semibold">Buscar termo</label>
    <input type="text" name="busca" id="busca" value="{{ busca|default:'' }}" placeholder="Digite o termo"
           class="w-full bg-slate-700 px-3 py-2 rounded text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
  </div>

  <div>
    <label for="status" class="block mb-1 font-semibold">Status da OS</label>
    <select name="status" id="status"
            class="w-full bg-slate-700 px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">
      <option value="" {% if not status_selecionado %}selected{% endif %}>Todos</option>
      <option value="Em Aberto" {% if status_selecionado == 'Em Aberto' %}selected{% endif %}>Em Aberto</option>
      <option value="Finalizada" {% if status_selecionado == 'Finalizada' %}selected{% endif %}>Finalizada</option>
    </select>
  </div>

  <div class="flex items-end">
    <button type="submit"
            class="w-full bg-indigo-600 hover:bg-indigo-500 text-white px-5 py-2 rounded font-semibold transition">
      Buscar
    </button>
  </div>
</form>

<!-- Tabela -->
<div class="overflow-auto bg-slate-800 rounded-lg shadow-lg">
  <table class="min-w-full table-auto text-left text-sm">
    <thead class="bg-slate-700 text-gray-300 uppercase tracking-wider">
      <tr>
        <th class="px-6 py-3">Nº OS</th>
        <th class="px-6 py-3">Data</th>
        <th class="px-6 py-3">Centro de Custo</th>
        <th class="px-6 py-3">Prioridade</th>
        <th class="px-6 py-3">Cliente</th>
      </tr>
    </thead>
    <tbody class="text-gray-100">
      {% for os in os_list %}
      <tr class="border-b border-slate-700 hover:bg-slate-600 transition-colors cursor-pointer">
        <td class="px-6 py-3 font-mono">
          <a href="{% url 'detalhes_os' os.numero_os %}" class="text-indigo-400 hover:underline">
            {{ os.numero_os }}
          </a>
        </td>
        <td class="px-6 py-3">{{ os.data_abertura|date:"d/m/Y H:i" }}</td>
        <td class="px-6 py-3">{{ os.cc }}</td>
        <td class="px-6 py-3">
          {% if os.prioridade == 'B' %}
            <span class="bg-green-600 px-3 py-1 rounded-full text-white font-semibold">Baixa</span>
          {% elif os.prioridade == 'A' %}
            <span class="bg-yellow-500 px-3 py-1 rounded-full text-white font-semibold">Alta</span>
          {% elif os.prioridade == 'C' %}
            <span class="bg-red-600 px-3 py-1 rounded-full text-white font-semibold">Crítica</span>
          {% endif %}
        </td>
        <td class="px-6 py-3">{{ os.cod_cliente }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center py-6 text-gray-400 italic">Nenhuma OS encontrada.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
